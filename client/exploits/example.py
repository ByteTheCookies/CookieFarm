#!/usr/bin/env python3

from utils.exploiter_manager import exploit_manager

# ----------
import requests
from bs4 import BeautifulSoup


@exploit_manager
def exploit(ip:str, port:int):

    flags = []
    base_url = f"http://{ip}:{port}"

    # Service 1
    r = requests.get(f"{base_url}/get-flag")
    flags.append(r.text)

    # Service 2
    r = requests.get(f"{base_url}/get-flag-sleep")
    flags.append(r.text)

    # Service 3
    r = requests.get(f"{base_url}/get-flag-somewhere")
    flags.append(r.text)

    # Service 4
    for i in range(1, 101):
        r = requests.post(f"{base_url}/get-flag-guess", data={"number": i})
        if "Congratulations" in r.text:
            flags.append(r.text)
            break

    # Service 5
    r = requests.get(f"{base_url}/get-flag-maze")

    while True:
        soup = BeautifulSoup(r.content, 'html.parser')
        page:str = soup.find("a")["href"]
        r = requests.get(base_url + page)
        if "Congratulations" in r.text:
            flags.append(r.text)
            break

    return flags


if __name__ == "__main__":
    port = 8081                 # Edit with port of the service to exploit
    exploit(port=port)
