import sys
from .exploiter import attack
from .cookie_server import get_ip_teams

def exploit_manager(func):
    def wrapper(*args, **kwargs):
        if 'port' not in kwargs:
            raise ValueError("Port is required")

        attack(
            exploit_function=func,
            ip_teams=get_ip_teams(
                server_address=sys.argv[1],
                password=sys.argv[2]
            ),
            port_service=kwargs['port'],
            flag_regex_format=sys.argv[4],
            tick_time=int(sys.argv[3])
        )
    return wrapper
