import sys
import asyncio

from re import compile
from .exploiter import attack_loop
from .cookie_server import get_ip_teams

# Batch option

def exploit_manager(func):
    def wrapper(*args, **kwargs):
        if 'port' not in kwargs:
            raise ValueError("Port is required")

        asyncio.run(attack_loop(
            exploit_function=func,
            ip_teams=get_ip_teams(
                server_address=sys.argv[1],
                password=sys.argv[2]
            ),
            port_service=kwargs['port'],
            flag_regex_re=compile(sys.argv[4]),
            tick_time=int(sys.argv[3])
        ))
    return wrapper
