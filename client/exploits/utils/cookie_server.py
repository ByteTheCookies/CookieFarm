import requests


def get_auth_session(server_address:str, password:str, auth_api_path:str = "/api/v1/auth/login") -> requests.Session:
    session = requests.Session()

    response = session.post(f"{server_address}{auth_api_path}", data={"password": password})
    if not response.ok:
        raise ValueError("Failed to get auth")

    return session

def get_ip_teams(server_address:str, password:str, config_api_path:str = "/api/v1/config") -> list[str]:
    session = get_auth_session(server_address=server_address, password=password)

    response = session.get(
        f"{server_address}{config_api_path}",
        headers={
            'Content-Type': 'application/json',
            'Cookie': f"token={session.cookies['token']}"
        }
    )
    if not response.ok:
        raise ValueError("Failed to get config")

    config_json = response.json()

    return [
        config_json["client"]["format_ip_teams"].format(i)
        for i in range(int(config_json["client"]["range_ip_teams"]) + 1)
        if i != int(config_json["client"]["my_team_ip"].split(".")[2])
    ]
